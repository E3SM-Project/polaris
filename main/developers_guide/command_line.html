

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Command-line interface</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=2188c0cb"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Organization of Tasks" href="organization/index.html" />
    <link rel="prev" title="Overview" href="overview.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Polaris
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/quick_start.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/suites.html">Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/ocean/index.html">Ocean component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/seaice/index.html">Sea ice component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/machines/index.html">Machines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Command-line interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#polaris-list">polaris list</a></li>
<li class="toctree-l2"><a class="reference internal" href="#polaris-setup">polaris setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#polaris-suite">polaris suite</a></li>
<li class="toctree-l2"><a class="reference internal" href="#polaris-serial">polaris serial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#polaris-cache">polaris cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mpas-to-yaml">mpas_to_yaml</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="organization/index.html">Organization of Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/index.html">Ocean component</a></li>
<li class="toctree-l1"><a class="reference internal" href="seaice/index.html">SeaIce component</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework/index.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploying_spack.html">Deploying a new spack environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/dev_add_test_group.html">Developer Tutorial: Adding a new test group</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Polaris</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Command-line interface</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/developers_guide/command_line.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="command-line-interface">
<span id="dev-command-line"></span><h1>Command-line interface<a class="headerlink" href="#command-line-interface" title="Link to this heading"></a></h1>
<p>The command-line interface for polaris acts essentially like 4 independent
scripts: <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">setup</span></code>, <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">suite</span></code>, and
<code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">serial</span></code>.  These are the primary user interface to the package, as
described below.</p>
<p>When the <code class="docutils literal notranslate"><span class="pre">polaris</span></code> package is installed into your conda environment, you can
run these commands as above.  If you are developing polaris from a local
branch off of <a class="reference external" href="https://github.com/E3SM-Project/polaris">https://github.com/E3SM-Project/polaris</a>, you will need to create a
conda environment appropriate for development (see <a class="reference internal" href="quick_start.html#dev-conda-env"><span class="std std-ref">polaris conda environment, spack environment, compilers and system modules</span></a>).
If you do, polaris will be installed in the environment in “development”
mode, meaning you can make changes to the branch and they will be reflected
when you call the <code class="docutils literal notranslate"><span class="pre">polaris</span></code> command-line tool.</p>
<section id="polaris-list">
<span id="dev-polaris-list"></span><h2>polaris list<a class="headerlink" href="#polaris-list" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">list</span></code> command is used to list tasks, suites, and
supported machines.  The command-line options are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ polaris list --help
usage: polaris list [-h] [-t TASK] [-n NUMBER] [--machines] [--suites] [-v]
</pre></div>
</div>
<p>By default, all tasks are listed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ polaris list
Tasks:
   0: ocean/planar/baroclinic_channel/10km/default
   1: ocean/planar/baroclinic_channel/10km/decomp
...
</pre></div>
</div>
<p>The number of each task is displayed, followed by the relative path that
will be used for the task in the work directory.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-h</span></code> or <code class="docutils literal notranslate"><span class="pre">--help</span></code> options will display the help message describing the
command-line options.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-t</span></code> or <code class="docutils literal notranslate"><span class="pre">--task_expr</span></code> flag can be used to supply a substring or regular
expression that can be used to list a subset of the tasks.  Think of this as
as search expression within the default list of task relative paths.</p>
<p>The flags <code class="docutils literal notranslate"><span class="pre">-n</span></code> or <code class="docutils literal notranslate"><span class="pre">--number</span></code> are used to list the name (relative path) of
a single task with the given number.</p>
<p>Instead of listing tasks, you can list all the supported machines that can
be passed to the <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">setup</span></code> and <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">suite</span></code> by using the
<code class="docutils literal notranslate"><span class="pre">--machines</span></code> flag.</p>
<p>Similarly, you can list all the available suites for all
<a class="reference internal" href="organization/components.html#dev-components"><span class="std std-ref">Components</span></a> by using the <code class="docutils literal notranslate"><span class="pre">--suites</span></code> flag.  The result are the flags
that would be passed  to <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">suite</span></code> as part of setting up this suite.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-v</span></code> or <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> flag lists more detail about each task,
including its description, short name, core, configuration, subdirectory within
the configuration and the names of its steps:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ polaris list -n 0 -v
path:          ocean/planar/baroclinic_channel/10km/default
name:          default
component:     ocean
subdir:        planar/baroclinic_channel/10km/default
steps:
 - init:    ocean/planar/baroclinic_channel/10km/init
 - forward: ocean/planar/baroclinic_channel/10km/default/forward
 - viz:     ocean/planar/baroclinic_channel/10km/default/viz
</pre></div>
</div>
<p>See <a class="reference internal" href="framework/commands.html#dev-list"><span class="std std-ref">list module</span></a> for more about the underlying framework.</p>
</section>
<section id="polaris-setup">
<span id="dev-polaris-setup"></span><h2>polaris setup<a class="headerlink" href="#polaris-setup" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">setup</span></code> command is used to set up one or more tasks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must have built the executable for the standalone MPAS component you
want to run before setting up a polaris task.</p>
</div>
<p>The command-line options are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ polaris setup --help
usage: polaris setup [-h] [-t PATH [PATH ...]] [-n NUM [NUM ...]] [-f FILE] [-m MACH] -w
                     PATH [-b PATH] [-p PATH] [--suite_name SUITE]
                     [--cached STEP [STEP ...]] [--copy_executable] [--clean]

</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-h</span></code> or <code class="docutils literal notranslate"><span class="pre">--help</span></code> options will display the help message describing the
command-line options.</p>
<p>The tasks to set up can be specified either by relative path or by number.
The <code class="docutils literal notranslate"><span class="pre">-t</span></code> or <code class="docutils literal notranslate"><span class="pre">--task</span></code> flag is used to pass the relative path of the task
within the resulting work directory.  The is the path given by
<a class="reference internal" href="#dev-polaris-list"><span class="std std-ref">polaris list</span></a>.  You can specify several tasks at once, separated by
spaces, this way.</p>
<p>Alternatively, you can supply the task numbers of any number of tasks to
the <code class="docutils literal notranslate"><span class="pre">-n</span></code> or <code class="docutils literal notranslate"><span class="pre">--task_number</span></code> flag.  Multiple test numbers are separated by
spaces.  These are the test numbers given by <a class="reference internal" href="#dev-polaris-list"><span class="std std-ref">polaris list</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">setup</span></code> requires a few basic pieces of information to be able to set
up a task.  These include places to download and cache some data files
used in the tasks and the location where you built the MPAS model.  There
are a few ways to to supply these.  The <code class="docutils literal notranslate"><span class="pre">-m</span></code> -r <code class="docutils literal notranslate"><span class="pre">--machine</span></code> option is used
to tell <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">setup</span></code> which supported machine you’re running on (leave this
off if you’re working on an “unknown” machine).  See <a class="reference internal" href="#dev-polaris-list"><span class="std std-ref">polaris list</span></a>
above for how to list the supported machines.</p>
<p>You can supply the directory where you have built the MPAS component with the
<code class="docutils literal notranslate"><span class="pre">-p</span></code> or <code class="docutils literal notranslate"><span class="pre">--component_path</span></code> flag.  This can be a relative or absolute path.  The
default for the <code class="docutils literal notranslate"><span class="pre">landice</span></code> component is
<code class="docutils literal notranslate"><span class="pre">e3sm_submodules/MALI-Dev/components/mpas-albany-landice</span></code>
and the default for the <code class="docutils literal notranslate"><span class="pre">ocean</span></code> component depends on whether you are using
MPAS-Ocean or Omega.  For MPAS-Ocean, it is
<code class="docutils literal notranslate"><span class="pre">e3sm_submodules/E3SM-Project/components/mpas-ocean</span></code>.  For Omega, it is
<code class="docutils literal notranslate"><span class="pre">e3sm_submodules/Omega/components/omega</span></code></p>
<p>You can also supply a config file with config options pointing to the
directories for cached data files, the location of the MPAS component, and much
more (see <a class="reference internal" href="../users_guide/config_files.html#config-files"><span class="std std-ref">Config Files</span></a> and <a class="reference internal" href="../users_guide/quick_start.html#setup-overview"><span class="std std-ref">Setting up tasks</span></a>).  Point to your config
file using the <code class="docutils literal notranslate"><span class="pre">-f</span></code> or <code class="docutils literal notranslate"><span class="pre">--config_file</span></code> flag.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-w</span></code> or <code class="docutils literal notranslate"><span class="pre">--work_dir</span></code> flags point to a relative or absolute path that
is the base path where the task(s) should be set up.  It is required that
you supply a work directory, and we recommend not using the polaris repo itself
but instead use a temp or scratch directory to avoid confusing the polaris code
with tasks setups and output within the branch.</p>
<p>To compare tasks with a previous run of the same tasks, use the
<code class="docutils literal notranslate"><span class="pre">-b</span></code> or <code class="docutils literal notranslate"><span class="pre">--baseline_dir</span></code> flag to point to the work directory of the
previous run.  Many tasks validate variables to make sure they are
identical between runs, compare timers to see how much performance has changed,
or both.  See <a class="reference internal" href="framework/validation.html#dev-validation"><span class="std std-ref">Validation</span></a>.</p>
<p>The tasks will be included in a “custom” suite in the order they are
named or numbered.  You can give this suite a name with <code class="docutils literal notranslate"><span class="pre">--suite_name</span></code> or
leave it with the default name <code class="docutils literal notranslate"><span class="pre">custom</span></code>.  You can run this suite with
<code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">serial</span> <span class="pre">[suite_name]</span></code> as with the predefined suites (see
<a class="reference internal" href="#dev-polaris-suite"><span class="std std-ref">polaris suite</span></a>).</p>
<p>Tasks within the custom suite are run in the order they are supplied to
<code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">setup</span></code>, so keep this in mind when providing the list.  Any test
cases that depend on the output of other tasks must run after their
dependencies.</p>
<p>You can uses <code class="docutils literal notranslate"><span class="pre">--cached</span></code> to specify steps of a test case to download from
pre-generated files if they are available (see <a class="reference internal" href="#dev-polaris-cache"><span class="std std-ref">polaris cache</span></a>.)</p>
<p>If you specify <code class="docutils literal notranslate"><span class="pre">--copy_executable</span></code>, the model executable will be copied to the
work directory rather than just symlinked.  This is useful if wish to run
the tasks again later but anticipate that you may have removed (or replaced)
the model code.</p>
<p>Finally, if you specify <code class="docutils literal notranslate"><span class="pre">--clean</span></code>. The base work directory pointed to with the
<code class="docutils literal notranslate"><span class="pre">-w</span></code> flag will be deleted before setting up the tasks.  This is useful if you
want to do a fresh run, since polaris will not rerun steps that have already
been run.</p>
<p>See <a class="reference internal" href="framework/commands.html#dev-setup"><span class="std std-ref">setup module</span></a> for more about the underlying framework.</p>
</section>
<section id="polaris-suite">
<span id="dev-polaris-suite"></span><h2>polaris suite<a class="headerlink" href="#polaris-suite" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">suite</span></code> command is used to set up a suite. The command-line
options are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ polaris suite --help
usage: polaris suite [-h] -c COMPONENT -t SUITE [-f FILE] [-m MACH] [-b PATH]
                     -w PATH [-p PATH] [--copy_executable] [--clean]
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-h</span></code> or <code class="docutils literal notranslate"><span class="pre">--help</span></code> options will display the help message describing the
command-line options.</p>
<p>The required argument are <code class="docutils literal notranslate"><span class="pre">-c</span></code> or <code class="docutils literal notranslate"><span class="pre">--component</span></code>, one of the <a class="reference internal" href="organization/components.html#dev-components"><span class="std std-ref">Components</span></a>,
where the suite and its tasks reside; and <code class="docutils literal notranslate"><span class="pre">-t</span></code> or <code class="docutils literal notranslate"><span class="pre">--test_suite</span></code>,
the name of the suite.  These are the options listed when you run
<code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">list</span> <span class="pre">--suites</span></code>. As with <a class="reference internal" href="#dev-polaris-setup"><span class="std std-ref">polaris setup</span></a>, you must supply a
work directory with <code class="docutils literal notranslate"><span class="pre">-w</span></code> or <code class="docutils literal notranslate"><span class="pre">--work_dir</span></code>.</p>
<p>As in <a class="reference internal" href="#dev-polaris-setup"><span class="std std-ref">polaris setup</span></a>, you can supply one or more of: a supported
machine with <code class="docutils literal notranslate"><span class="pre">-m</span></code> or <code class="docutils literal notranslate"><span class="pre">--machine</span></code>; a path where you build MPAS model via
<code class="docutils literal notranslate"><span class="pre">-p</span></code> or <code class="docutils literal notranslate"><span class="pre">--mpas_model</span></code>; and a config file containing config options to
override the defaults with <code class="docutils literal notranslate"><span class="pre">-f</span></code> or <code class="docutils literal notranslate"><span class="pre">--config_file</span></code>.  As with
<a class="reference internal" href="#dev-polaris-setup"><span class="std std-ref">polaris setup</span></a>, you may optionally supply a baseline directory for
comparison with <code class="docutils literal notranslate"><span class="pre">-b</span></code> or <code class="docutils literal notranslate"><span class="pre">--baseline_dir</span></code>.  If supplied, each task in the
suite that includes <a class="reference internal" href="framework/validation.html#dev-validation"><span class="std std-ref">Validation</span></a> will be validated against the
previous run in the baseline.</p>
<p>The flags <code class="docutils literal notranslate"><span class="pre">--copy_executable</span></code>and <code class="docutils literal notranslate"><span class="pre">--clean</span></code> are the same as in
<a class="reference internal" href="#dev-polaris-setup"><span class="std std-ref">polaris setup</span></a>.</p>
<p>See <a class="reference internal" href="framework/commands.html#dev-suite"><span class="std std-ref">suite module</span></a> for more about the underlying framework.</p>
</section>
<section id="polaris-serial">
<span id="dev-polaris-run"></span><h2>polaris serial<a class="headerlink" href="#polaris-serial" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">serial</span></code> command is used to run (in sequence, as opposed to in task
parallel) a suite, task or step  that has been set up in the current
directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ polaris serial --help
usage: polaris serial [-h] [--steps STEPS [STEPS ...]]
                      [--skip_steps SKIP_STEPS [SKIP_STEPS ...]] [-q]
                      [--step_is_subprocess]
                      [suite]
</pre></div>
</div>
<p>Whereas other <code class="docutils literal notranslate"><span class="pre">polaris</span></code> commands are typically run in the local clone of the
polaris repo, <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">serial</span></code> needs to be run in the appropriate work
directory. If you are running a suite, you may need to provide the name
of the suite if more than one suite has been set up in the same work
directory.  You can provide either just the suite name or
<code class="docutils literal notranslate"><span class="pre">&lt;suite_name&gt;.pickle</span></code> (the latter is convenient for tab completion).  If you
are in the work directory for a task or step, you do not need to provide
any arguments.</p>
<p>If you want to explicitly select which steps in a task you want to run,
you have two options.  You can either edit the <code class="docutils literal notranslate"><span class="pre">steps_to_run</span></code> config options
in the config file:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[task]</span>
<span class="na">steps_to_run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">init full_run restart_run</span>
</pre></div>
</div>
<p>Or you can use <code class="docutils literal notranslate"><span class="pre">--steps</span></code> to supply a list of steps to run, or <code class="docutils literal notranslate"><span class="pre">--skip_steps</span></code>
to supply a list of steps you do not want to run (from the defaults given in
the config file).  For example,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>polaris serial --steps init full_run
</pre></div>
</div>
<p>or</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>polaris serial --skip_steps restart_run
</pre></div>
</div>
<p>Would both accomplish the same thing in this example – skipping the
<code class="docutils literal notranslate"><span class="pre">restart_run</span></code> step of the task.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If changes are made to <code class="docutils literal notranslate"><span class="pre">steps_to_run</span></code> in the config file and <code class="docutils literal notranslate"><span class="pre">--steps</span></code>
is provided on the command line, the command-line flags take precedence
over the config option.</p>
</div>
<p>To see which steps are are available in a given task, you need to run
<a class="reference internal" href="#dev-polaris-list"><span class="std std-ref">polaris list</span></a> with the <code class="docutils literal notranslate"><span class="pre">-v</span></code> or <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> flag.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--step_is_subprocess</span></code> flag is for internal use by the framework so you
shouldn’t need to use that flag.</p>
<p>See <a class="reference internal" href="framework/commands.html#dev-run"><span class="std std-ref">run.serial module</span></a> for more about the underlying framework.</p>
</section>
<section id="polaris-cache">
<span id="dev-polaris-cache"></span><h2>polaris cache<a class="headerlink" href="#polaris-cache" title="Link to this heading"></a></h2>
<p>Polaris supports caching outputs from any step in a special database
called <code class="docutils literal notranslate"><span class="pre">polaris_cache</span></code> (see <a class="reference internal" href="organization/steps.html#dev-step-input-download"><span class="std std-ref">Downloading and symlinking input files</span></a>). Files in this
database have a directory structure similar to the work directory (but without
the component subdirectory, which is redundant). The files include a date stamp
so that new revisions can be added without removing older ones (supported by
older polaris versions).  See <a class="reference internal" href="organization/steps.html#dev-step-cached-output"><span class="std std-ref">Cached output files</span></a> for more details.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">cache</span></code> is used to update the file <code class="docutils literal notranslate"><span class="pre">cached_files.json</span></code>
within a component.  This command is only available on Anvil and Chrysalis,
since developers can only copy files from a Polaris work directory onto the
LCRC server from these two machines.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ polaris cache --help
usage: polaris cache [-h] [-i STEP [STEP ...]] [-d DATE] [-r]
</pre></div>
</div>
<p>Developers run <code class="docutils literal notranslate"><span class="pre">polaris</span> <span class="pre">cache</span></code> from the base work directory, giving the
relative paths of the step whose outputs should be cached:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>polaris<span class="w"> </span>cache<span class="w"> </span>-i<span class="w"> </span>ocean/spherical/*/base_mesh/*<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ocean/spherical/*/cosine_bell/init/*
</pre></div>
</div>
<p>This will:</p>
<ol class="arabic simple">
<li><p>copy the output files from the steps directories into the appropriate
<code class="docutils literal notranslate"><span class="pre">polaris_cache</span></code> location on the LCRC server and</p></li>
<li><p>add these files to a local <code class="docutils literal notranslate"><span class="pre">ocean_cached_files.json</span></code> that can then be
copied to <code class="docutils literal notranslate"><span class="pre">polaris/ocean</span></code> as part of a PR to add a cached version of a
step.</p></li>
</ol>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">ocean_cached_files.json</span></code> will look something like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/icos/base_mesh/120km/mesh.msh&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/icos/base_mesh/120km/mesh.230914.msh&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/icos/base_mesh/120km/base_mesh.nc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/icos/base_mesh/120km/base_mesh.230914.nc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/icos/base_mesh/120km/cellWidthVsLatLon.nc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/icos/base_mesh/120km/cellWidthVsLatLon.230914.nc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/icos/base_mesh/120km/graph.info&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/icos/base_mesh/120km/graph.230914.info&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/icos/base_mesh/240km/mesh.msh&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/icos/base_mesh/240km/mesh.230914.msh&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/icos/base_mesh/240km/base_mesh.nc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/icos/base_mesh/240km/base_mesh.230914.nc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/icos/base_mesh/240km/cellWidthVsLatLon.nc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/icos/base_mesh/240km/cellWidthVsLatLon.230914.nc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/icos/base_mesh/240km/graph.info&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/icos/base_mesh/240km/graph.230914.info&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/qu/cosine_bell/init/210km/initial_state.nc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/qu/cosine_bell/init/210km/initial_state.230914.nc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/qu/cosine_bell/init/240km/initial_state.nc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/qu/cosine_bell/init/240km/initial_state.230914.nc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/qu/cosine_bell/init/60km/initial_state.nc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/qu/cosine_bell/init/60km/initial_state.230914.nc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ocean/spherical/qu/cosine_bell/init/90km/initial_state.nc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spherical/qu/cosine_bell/init/90km/initial_state.230914.nc&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An optional flag <code class="docutils literal notranslate"><span class="pre">--date_string</span></code> lets the developer set the date string to
a date they choose.  The default is today’s date.</p>
<p>The flag <code class="docutils literal notranslate"><span class="pre">--dry_run</span></code> can be used to sanity check the resulting <code class="docutils literal notranslate"><span class="pre">json</span></code> file
and the list of files printed to stdout without actually copying the files to
the LCRC server.</p>
<p>See <a class="reference internal" href="framework/commands.html#dev-cache"><span class="std std-ref">cache module</span></a> for more about the underlying framework.</p>
</section>
<section id="mpas-to-yaml">
<span id="dev-mpas-to-yaml"></span><h2>mpas_to_yaml<a class="headerlink" href="#mpas-to-yaml" title="Link to this heading"></a></h2>
<p>For convenience of translating from compass to polaris, we have added an
<code class="docutils literal notranslate"><span class="pre">mpas_to_yaml</span></code> tool that can be used to convert a namelist and/or streams file
into a yaml file.  You need to point to a namelist template (e.g.
<code class="docutils literal notranslate"><span class="pre">namelist.ocean.forward</span></code> from the directory where you have built MPAS-Ocean)
because the compass namelist files don’t include the namelist sections,
required by the yaml format.  Note that, for the <code class="docutils literal notranslate"><span class="pre">ocean</span></code> component, the <code class="docutils literal notranslate"><span class="pre">model</span></code>
is a keyword that will be added at the top of the yaml file but is ignored when
the yaml file gets parsed, so its value doesn’t matter.  We recommend using
<code class="docutils literal notranslate"><span class="pre">omega</span></code> since the yaml file is in Omega’s format, but it will also be usable
when the task is configured for MPAS-Ocean.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="organization/index.html" class="btn btn-neutral float-right" title="Organization of Tasks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Energy Exascale Earth System Model Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="command_line.html">main</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>