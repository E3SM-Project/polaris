

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Updating Conda Dependencies</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=a8da1a53"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Updating Shared Spack Environments" href="updating_spack/index.html" />
    <link rel="prev" title="How Conda and Spack Work Together in Polaris" href="conda_vs_spack.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Polaris
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/quick_start.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/suites.html">Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/mesh/index.html">Mesh component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/ocean/index.html">Ocean component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/seaice/index.html">Sea ice component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/machines/index.html">Machines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="organization/index.html">Organization of Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="e3sm/init/index.html">E3SM initial condition (e3sm/init) component</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh/index.html">Mesh component</a></li>
<li class="toctree-l1"><a class="reference internal" href="ocean/index.html">Ocean component</a></li>
<li class="toctree-l1"><a class="reference internal" href="seaice/index.html">Sea ice component</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework/index.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_docs.html#previewing-the-documentation">Previewing the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="conda_vs_spack.html">How Conda and Spack Work Together in Polaris</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Updating Conda Dependencies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#polaris-versioning-scheme">üè∑Ô∏è Polaris Versioning Scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="#workflow-for-dependency-changes">üîÑ Workflow for Dependency Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bump-the-alpha-version">‚¨ÜÔ∏è Bump the <code class="docutils literal notranslate"><span class="pre">alpha</span></code> version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-dependencies">‚úçÔ∏è Updating dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conda-dev-spec-template"><code class="docutils literal notranslate"><span class="pre">conda-dev-spec.template</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#default-cfg"><code class="docutils literal notranslate"><span class="pre">default.cfg</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="updating_spack/index.html">Updating Shared Spack Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/dev_add_category_of_tasks/index.html">Developer Tutorial: Adding a New Category of Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Polaris</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Updating Conda Dependencies</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/developers_guide/updating_conda.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="updating-conda-dependencies">
<span id="dev-updating-conda"></span><h1>Updating Conda Dependencies<a class="headerlink" href="#updating-conda-dependencies" title="Link to this heading">ÔÉÅ</a></h1>
<section id="polaris-versioning-scheme">
<h2>üè∑Ô∏è Polaris Versioning Scheme<a class="headerlink" href="#polaris-versioning-scheme" title="Link to this heading">ÔÉÅ</a></h2>
<p>Polaris is primarily a developer-focused project and is in a perpetual ‚Äúalpha‚Äù
stage. Versions in the <code class="docutils literal notranslate"><span class="pre">main</span></code> branch always end with <code class="docutils literal notranslate"><span class="pre">-alpha.&lt;N&gt;</span></code>.
Occasionally, releases are tagged without the <code class="docutils literal notranslate"><span class="pre">-alpha.&lt;N&gt;</span></code> for documentation
and provenance.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">alpha</span></code> version is incremented each time Polaris‚Äô Conda dependencies
change. This signals to developers and deployment infrastructure that
environments created with an older alpha version may not be compatible with
the new code.</p>
</section>
<section id="workflow-for-dependency-changes">
<h2>üîÑ Workflow for Dependency Changes<a class="headerlink" href="#workflow-for-dependency-changes" title="Link to this heading">ÔÉÅ</a></h2>
<p>When Conda dependencies are updated (added or version-bumped), the <code class="docutils literal notranslate"><span class="pre">alpha</span></code>
version must also be incremented. This ensures developers know when their
Conda environments are out of date and need to be recreated or updated.</p>
<p>Each time a developer sources a Polaris load script (see <a class="reference internal" href="quick_start.html#dev-conda-env"><span class="std std-ref">polaris conda environment, spack environment, compilers and system modules</span></a>),
the script checks that the Polaris version (including <code class="docutils literal notranslate"><span class="pre">alpha</span></code>) matches the one
used to create the Conda environment. If not, an error message prompts the
developer to update or recreate the environment.</p>
<p>Unless Spack dependencies are also changed (in which case you need to follow
the workflow in <a class="reference internal" href="updating_spack/index.html#dev-updating-spack"><span class="std std-ref">Updating Shared Spack Environments</span></a>), there is no need to deploy shared
Spack environments‚Äîjust update Conda dependencies, bump the <code class="docutils literal notranslate"><span class="pre">alpha</span></code> version,
make a pull request, and merge.</p>
</section>
<hr class="docutils" />
<section id="bump-the-alpha-version">
<h2>‚¨ÜÔ∏è Bump the <code class="docutils literal notranslate"><span class="pre">alpha</span></code> version<a class="headerlink" href="#bump-the-alpha-version" title="Link to this heading">ÔÉÅ</a></h2>
<p>Unless you are updating share Spack environments, you need to start by
updating the Polaris version to the next <code class="docutils literal notranslate"><span class="pre">alpha</span></code> number in <code class="docutils literal notranslate"><span class="pre">polaris/version.py</span></code>
and committing the change.  For example, change:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.8.0-alpha.9&#39;</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.8.0-alpha.10&#39;</span>
</pre></div>
</div>
<p>and commit this with a message like, ‚ÄúUpdate Polaris to v0.8.0-alpha.10‚Äù.</p>
</section>
<hr class="docutils" />
<section id="updating-dependencies">
<h2>‚úçÔ∏è Updating dependencies<a class="headerlink" href="#updating-dependencies" title="Link to this heading">ÔÉÅ</a></h2>
<p>There are two places you might need to make the changes to the dependencies,
depending on the package(s) involved.</p>
<section id="conda-dev-spec-template">
<h3><code class="docutils literal notranslate"><span class="pre">conda-dev-spec.template</span></code><a class="headerlink" href="#conda-dev-spec-template" title="Link to this heading">ÔÉÅ</a></h3>
<p>The <a class="reference external" href="https://jinja.palletsprojects.com/en/stable/">Jinja template</a> that defines
Polaris‚Äô Conda environments is
<a class="reference external" href="https://github.com/E3SM-Project/polaris/blob/main/deploy/conda-dev-spec.template"><code class="docutils literal notranslate"><span class="pre">deploy/conda-dev-spec.template</span></code></a>.
This file is the easiest place to add new Conda dependencies.  It is the right
place to add dependencies that you do not plan to pin to a specific version
and which will not also be installed in a shared Spack environment.</p>
<p>Add your new dependency in the appropriate location:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Base</span></code> - runtime Polaris dependencies not associated with development</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Static</span> <span class="pre">typing</span></code> - dependencies for Python type checking</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Linting</span> <span class="pre">and</span> <span class="pre">testing</span></code> - tools for linthing the code and running simple
unit tests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Development</span></code> - other development requirements like MPI, CMake and
compilers, typically only used on unsupported machines such as laptops</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">CF-compliance</span></code> - tools that are handy for checking
<a class="reference external" href="https://cfconventions.org/">CF compliance</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Documentation</span></code> - tools for building the documentation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Visualization</span></code> - tools for quick visualization, not directly required
by any Polaris tasks or steps</p></li>
</ul>
</section>
<section id="default-cfg">
<h3><code class="docutils literal notranslate"><span class="pre">default.cfg</span></code><a class="headerlink" href="#default-cfg" title="Link to this heading">ÔÉÅ</a></h3>
<p>Several Conda packages have fixed versions defined in <code class="docutils literal notranslate"><span class="pre">deploy/default.cfg</span></code>.
Currently, these are:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="na">python</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3.13</span>

<span class="c1"># versions of conda packages</span>
<span class="na">geometric_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.6.1</span>
<span class="na">mache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.31.0</span>
<span class="na">conda_moab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5.5.1</span>
<span class="na">mpas_tools</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.2.0</span>
<span class="na">otps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2021.10</span>
<span class="na">parallelio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2.6.6</span>
</pre></div>
</div>
<p>We choose to define these ‚Äúpinned‚Äù versions in the config file so that
developers can override them with their own config file (which might be
convenient for testing) and so that we can easily reference these versions in
multiple places during the deployment workflow if needed.</p>
<p><strong>Note:</strong> We treat the MOAB package as a special case with different versions
from conda-forge (<code class="docutils literal notranslate"><span class="pre">conda_moab</span></code>) and Spack (<code class="docutils literal notranslate"><span class="pre">spack_moab</span></code>).  This is because
MOAB has infrequent releases and, in the past, we have need features and bug
fixes that are only available from the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch. Since the <code class="docutils literal notranslate"><span class="pre">master</span></code>
version is not available on conda-forge, when we need the latest MOAB features
on machines with spack support, we still must fall back on the latest release
for use on login nodes and unsupported machines.</p>
<p>Some versions defined in <code class="docutils literal notranslate"><span class="pre">default.cfg</span></code> apply to both Conda and Spack package:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># versions of conda or spack packages (depending on machine type)</span>
<span class="na">esmf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8.8.1</span>
<span class="na">metis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5.1.0</span>
<span class="na">netcdf_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">4.9.2</span>
<span class="na">netcdf_fortran</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">4.6.2</span>
<span class="na">pnetcdf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1.14.0</span>
</pre></div>
</div>
<p>If those get updated, you will probably need to deploy new shared Spack
environments, meaning you will need to follow the full
<a class="reference internal" href="updating_spack/workflow.html"><span class="std std-doc">Spack Deployment Workflow</span></a>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="conda_vs_spack.html" class="btn btn-neutral float-left" title="How Conda and Spack Work Together in Polaris" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="updating_spack/index.html" class="btn btn-neutral float-right" title="Updating Shared Spack Environments" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Energy Exascale Earth System Model Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   

  <!-- Meta tags for JS to use -->
  <meta name="doc-version" content="main">
  <meta name="doc-site-root" content="../">

  <!-- Create version switcher container -->
  <script>
    const sidebar = document.querySelector('.wy-side-nav-search');
    if (sidebar) {
      const versionDiv = document.createElement('div');
      versionDiv.id = 'version-switcher';
      versionDiv.style.marginTop = '1em';
      sidebar.appendChild(versionDiv);
    }
  </script>

  <!-- Load version-switcher.js using the correct relative path -->
  <script src="../../shared/version-switcher.js"></script>


</body>
</html>