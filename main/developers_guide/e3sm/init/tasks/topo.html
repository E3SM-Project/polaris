

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Topography Tasks</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=a8da1a53"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Mesh component" href="../../../mesh/index.html" />
    <link rel="prev" title="Tasks" href="index.html" />
    <link href="../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Polaris
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../users_guide/quick_start.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../users_guide/tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../users_guide/config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../users_guide/suites.html">Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../users_guide/mesh/index.html">Mesh component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../users_guide/ocean/index.html">Ocean component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../users_guide/seaice/index.html">Sea ice component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../users_guide/machines/index.html">Machines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../command_line.html">Command-line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../organization/index.html">Organization of Tasks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">E3SM initial condition (e3sm/init) component</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Tasks</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Topography Tasks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#combine-steps-and-tasks">Combine Steps and Tasks</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../mesh/index.html">Mesh component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ocean/index.html">Ocean component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../seaice/index.html">Sea ice component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../framework/index.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../building_docs.html#previewing-the-documentation">Previewing the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deploying_spack.html">Deploying a new spack environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/dev_add_test_group.html">Developer Tutorial: Adding a new test group</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Polaris</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">E3SM initial condition (e3sm/init) component</a></li>
          <li class="breadcrumb-item"><a href="index.html">Tasks</a></li>
      <li class="breadcrumb-item active">Topography Tasks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/developers_guide/e3sm/init/tasks/topo.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="topography-tasks">
<h1>Topography Tasks<a class="headerlink" href="#topography-tasks" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">polaris.tasks.e3sm.init.topo</span></code> module provides tools for working with
topography data in Polaris. This includes steps for processing, modifying, and
combining topography datasets to create inputs for E3SM components such as
MPAS-Ocean. The framework is designed to handle both global and regional
datasets, supporting various grid types like lat-lon and cubed-sphere grids.</p>
<section id="combine-steps-and-tasks">
<h2>Combine Steps and Tasks<a class="headerlink" href="#combine-steps-and-tasks" title="Link to this heading"></a></h2>
<a class="reference internal image-reference" href="../../../../_images/bathymetry_500.png"><img alt="../../../../_images/bathymetry_500.png" class="align-center" src="../../../../_images/bathymetry_500.png" style="width: 500px;" />
</a>
<p>Global datasets of base elevation (land surface elevation and ocean bathymetry)
do not typically include the latest datasets around Antarctica needed for
ice-sheet and ice-shelf modeling. For this reason, we typically combine a
global topography dataset north of the Southern Ocean with one for Antarctica.</p>
<p>The <a class="reference internal" href="../generated/polaris.tasks.e3sm.init.topo.combine.CombineStep.html#polaris.tasks.e3sm.init.topo.combine.CombineStep" title="polaris.tasks.e3sm.init.topo.combine.CombineStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">polaris.tasks.e3sm.init.topo.combine.CombineStep</span></code></a> step is a key
component of the topography framework. It is responsible for combining global
and Antarctic topography datasets into a single dataset suitable for use in
E3SM simulations. The step supports blending datasets across specified latitude
ranges and remapping them to a target grid.</p>
<p>The <a class="reference internal" href="../generated/polaris.tasks.e3sm.init.topo.combine.CombineTask.html#polaris.tasks.e3sm.init.topo.combine.CombineTask" title="polaris.tasks.e3sm.init.topo.combine.CombineTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">polaris.tasks.e3sm.init.topo.combine.CombineTask</span></code></a> wraps the
<code class="docutils literal notranslate"><span class="pre">CombineStep</span></code> into a task that can be used to generate and cache combined
topography datasets for reuse in other contexts.</p>
<p>The <a class="reference internal" href="../generated/polaris.tasks.e3sm.init.topo.combine.VizCombinedStep.html#polaris.tasks.e3sm.init.topo.combine.VizCombinedStep" title="polaris.tasks.e3sm.init.topo.combine.VizCombinedStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">polaris.tasks.e3sm.init.topo.combine.VizCombinedStep</span></code></a> step is
an optional visualization step that can be added to the workflow to create
plots of the combined topography dataset. This step is particularly useful for
debugging or analyzing the combined dataset.</p>
<section id="high-resolution-and-low-resolution-versions">
<h3>High-Resolution and Low-Resolution Versions<a class="headerlink" href="#high-resolution-and-low-resolution-versions" title="Link to this heading"></a></h3>
<p>There are two versions of the combine steps and task:</p>
<ol class="arabic simple">
<li><p><strong>Standard (High-Resolution) Version</strong>: This version maps to a
high-resolution (ne3000, ~1 km) cubed-sphere grid by default, producing
topogrpahy that is suitable for remapping to standard and high-resolution
MPAS meshes (~60 km and finer).</p></li>
<li><p><strong>Low-Resolution Version</strong>: This version uses a coarser ne120 (~25 km) grid
for faster remapping to coarse-resolution MPAS meshes (e.g., Icos240). It is
designed to reduce computational cost while still providing adequate accuracy
for low-resolution simulations used for regression testing rather than
science.</p></li>
</ol>
<p>The low-resolution version can be selected by setting the <code class="docutils literal notranslate"><span class="pre">low_res</span></code> parameter
to <code class="docutils literal notranslate"><span class="pre">True</span></code> when creating the <code class="docutils literal notranslate"><span class="pre">CombineStep</span></code> or <code class="docutils literal notranslate"><span class="pre">CombineTask</span></code>.</p>
</section>
<section id="key-features">
<h3>Key Features<a class="headerlink" href="#key-features" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Dataset Support</strong>: Supports multiple datasets, including <code class="docutils literal notranslate"><span class="pre">bedmap3</span></code>,
<code class="docutils literal notranslate"><span class="pre">bedmachinev3</span></code>, and <code class="docutils literal notranslate"><span class="pre">gebco2023</span></code>.</p></li>
<li><p><strong>Grid Types</strong>: Handles both lat-lon and cubed-sphere target grids.</p></li>
<li><p><strong>Blending</strong>: Blends global and Antarctic datasets across a configurable
latitude range.</p></li>
<li><p><strong>Remapping</strong>: Uses tools like <code class="docutils literal notranslate"><span class="pre">mbtempest</span></code>, <code class="docutils literal notranslate"><span class="pre">ESMF_RegridWeightGen</span></code> and
<code class="docutils literal notranslate"><span class="pre">ncremap</span></code> for remapping datasets to the target grid.</p></li>
<li><p><strong>Output</strong>: Produces combined topography datasets with consistent variables
and attributes.</p></li>
<li><p><strong>Visualization</strong>: Generates rasterized images of various fields (e.g.,
base elevation, ice draft) using the <code class="docutils literal notranslate"><span class="pre">datashader</span></code> library.</p></li>
</ul>
</section>
<section id="configuration-options">
<h3>Configuration Options<a class="headerlink" href="#configuration-options" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">CombineStep</span></code> step is configured through the <code class="docutils literal notranslate"><span class="pre">[combine_topo]</span></code> section in
the configuration file. Key options include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">resolution_latlon</span></code>: Target resolution for lat-lon grids (in degrees).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resolution_cubedsphere</span></code>: Target resolution for cubed-sphere grids (e.g.,
<code class="docutils literal notranslate"><span class="pre">3000</span></code> for NExxx grids).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latmin</span></code> and <code class="docutils literal notranslate"><span class="pre">latmax</span></code>: Latitude range for blending datasets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ntasks</span></code> and <code class="docutils literal notranslate"><span class="pre">min_tasks</span></code>: Number of MPI tasks for remapping.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method</span></code>: Remapping method (e.g., <code class="docutils literal notranslate"><span class="pre">bilinear</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lat_tiles</span></code> and <code class="docutils literal notranslate"><span class="pre">lon_tiles</span></code>: Number of tiles to split the global dataset for parallel remapping.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">renorm_thresh</span></code>: Threshold for renormalizing Antarctic variables during blending.</p></li>
</ul>
<p>For the low-resolution version, additional configuration options are provided
in the <code class="docutils literal notranslate"><span class="pre">combine_low_res.cfg</span></code> file.</p>
</section>
<section id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Setup</strong>: The step downloads required datasets and sets up input/output
files.</p></li>
<li><p><strong>Modification</strong>: Antarctic and global datasets are modified to include
necessary variables and attributes.</p></li>
<li><p><strong>Remapping</strong>: Datasets are remapped to the target grid using SCRIP files
and weight generation.</p></li>
<li><p><strong>Blending</strong>: The datasets are blended across the specified latitude range.</p></li>
<li><p><strong>Output</strong>: The combined dataset is saved in NetCDF format.</p></li>
<li><p><strong>Optional Field Plotting</strong>: Each field in the dataset is rasterized and
saved as an image with a colorbar.</p></li>
</ol>
</section>
<section id="example-usage">
<h3>Example Usage<a class="headerlink" href="#example-usage" title="Link to this heading"></a></h3>
<p>Below is an example of how the <code class="docutils literal notranslate"><span class="pre">CombineStep</span></code> can be added to a Polaris
task:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">polaris.tasks.e3sm.init.topo.combine</span><span class="w"> </span><span class="kn">import</span> <span class="n">CombineStep</span>

<span class="n">component</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">component</span>
<span class="n">subdir</span> <span class="o">=</span> <span class="n">CombineStep</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(</span><span class="n">low_res</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">if</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">subdir</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">CombineStep</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span> <span class="n">low_res</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="n">task</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
</pre></div>
</div>
<p>To create a <code class="docutils literal notranslate"><span class="pre">CombineTask</span></code> for caching combined datasets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">polaris.tasks.e3sm.init.topo.combine</span><span class="w"> </span><span class="kn">import</span> <span class="n">CombineTask</span>

<span class="n">combine_task</span> <span class="o">=</span> <span class="n">CombineTask</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">my_component</span><span class="p">,</span> <span class="n">low_res</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">my_component</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">combine_task</span><span class="p">)</span>
</pre></div>
</div>
<p>Below is an example of how the <code class="docutils literal notranslate"><span class="pre">VizCombinedStep</span></code> can be added to a Polaris task:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">polaris.tasks.e3sm.init.topo.combine</span><span class="w"> </span><span class="kn">import</span> <span class="n">VizCombinedStep</span>

<span class="n">viz_step</span> <span class="o">=</span> <span class="n">VizCombinedStep</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">my_component</span><span class="p">,</span> <span class="n">combine_step</span><span class="o">=</span><span class="n">combine_step</span><span class="p">)</span>
<span class="n">my_component</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">viz_step</span><span class="p">)</span>
</pre></div>
</div>
<p>Since there is a single shared step for each pair of Antarctic and global
datasets, the step should be added only once to the component and the existing
step (identifiable via its <code class="docutils literal notranslate"><span class="pre">subdir</span></code>) should be used subsequently.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">VizCombinedStep</span></code> is typically added only when visualization is explicitly required, as it is not part of the default workflow.</p>
<p>For more details, refer to the source code of the
<a class="reference internal" href="../generated/polaris.tasks.e3sm.init.topo.combine.CombineStep.html#polaris.tasks.e3sm.init.topo.combine.CombineStep" title="polaris.tasks.e3sm.init.topo.combine.CombineStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">polaris.tasks.e3sm.init.topo.combine.CombineStep</span></code></a> and
<a class="reference internal" href="../generated/polaris.tasks.e3sm.init.topo.combine.CombineTask.html#polaris.tasks.e3sm.init.topo.combine.CombineTask" title="polaris.tasks.e3sm.init.topo.combine.CombineTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">polaris.tasks.e3sm.init.topo.combine.CombineTask</span></code></a> classes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since this step is expensive and time-consuming to run, most tasks will
want to use cached outputs from this step rather than running it in full.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Tasks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../mesh/index.html" class="btn btn-neutral float-right" title="Mesh component" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Energy Exascale Earth System Model Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   

  <!-- Meta tags for JS to use -->
  <meta name="doc-version" content="main">
  <meta name="doc-site-root" content="../../../../">

  <!-- Create version switcher container -->
  <script>
    const sidebar = document.querySelector('.wy-side-nav-search');
    if (sidebar) {
      const versionDiv = document.createElement('div');
      versionDiv.id = 'version-switcher';
      versionDiv.style.marginTop = '1em';
      sidebar.appendChild(versionDiv);
    }
  </script>

  <!-- Load version-switcher.js using the correct relative path -->
  <script src="../../../../../shared/version-switcher.js"></script>


</body>
</html>