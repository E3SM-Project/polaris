<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Components</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Categories of tasks" href="categories_of_tasks.html" />
    <link rel="prev" title="Directory structure" href="directories.html" />
    <link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Polaris
          </a>
              <div class="version">
                0.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/quick_start.html">Quick Start for Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/config_files.html">Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/suites.html">Suites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/ocean/index.html">Ocean component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/seaice/index.html">Sea ice component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../users_guide/machines/index.html">Machines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_line.html">Command-line interface</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Organization of Tasks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="directories.html">Directory structure</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#constructor">Constructor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#config-file">Config file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="categories_of_tasks.html">Categories of tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks.html">Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="steps.html">Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="suites.html">Suites</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ocean/index.html">Ocean component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../seaice/index.html">SeaIce component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../framework/index.html">Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machines/index.html">Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building_docs.html">Building the Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploying_spack.html">Deploying a new spack environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design_docs/index.html">Design Documents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/dev_add_test_group.html">Developer Tutorial: Adding a new test group</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Polaris</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Organization of Tasks</a></li>
      <li class="breadcrumb-item active">Components</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/developers_guide/organization/components.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="components">
<span id="dev-components"></span><h1>Components<a class="headerlink" href="#components" title="Permalink to this heading"></a></h1>
<p>Currently, there are two components, <code class="docutils literal notranslate"><span class="pre">ocean</span></code>, which encompasses all the tasks
for MPAS-Ocean and OMEGA, and <code class="docutils literal notranslate"><span class="pre">seaice</span></code>, which implements tasks for MPAS-Seaice.</p>
<p>From a developer’s perspective, a component is a package within polaris
that has four major pieces:</p>
<ol class="arabic simple">
<li><p>A class that descends from the <a class="reference internal" href="../generated/polaris.Component.html#polaris.Component" title="polaris.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">polaris.Component</span></code></a> base class.
The class is defined in <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> and its <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method
calls the <code class="xref py py-meth docutils literal notranslate"><span class="pre">polaris.Component.add_tasks()</span></code> method (or helper
functions that, in turn, call this method) to add tasks to the component.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">tasks</span></code> package, which contains packages for individual tasks and their
steps, possibly within packages that help to sort them into broader
categories.</p></li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">&lt;component&gt;.cfg</span></code> config file containing any default config options
that are universal to all tasks of the component.</p></li>
<li><p>Additional “framework” packages and modules shared broadly between tasks.</p></li>
</ol>
<p>The component’s framework is a mix of shared code and other files (config
files, YAML files for model config options, etc.) that is expected to be used
only by modules and packages within the component, not by other components or
the main polaris <a class="reference internal" href="../framework/index.html#dev-framework"><span class="std std-ref">Framework</span></a>.</p>
<section id="constructor">
<h2>Constructor<a class="headerlink" href="#constructor" title="Permalink to this heading"></a></h2>
<p>The constructor (<code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method) for a child class of
<a class="reference internal" href="../generated/polaris.Component.html#polaris.Component" title="polaris.Component"><code class="xref py py-class docutils literal notranslate"><span class="pre">polaris.Component</span></code></a> simply calls the parent class’ version
of the constructor with <code class="docutils literal notranslate"><span class="pre">super().__init__()</span></code>, passing the name of the
component.  Then, it calls helper functions to add tasks to the component, as
in this example from <a class="reference internal" href="../ocean/generated/polaris.ocean.Ocean.html#polaris.ocean.Ocean" title="polaris.ocean.Ocean"><code class="xref py py-class docutils literal notranslate"><span class="pre">polaris.ocean.Ocean</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">polaris</span> <span class="kn">import</span> <span class="n">Component</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.baroclinic_channel</span> <span class="kn">import</span> <span class="n">add_baroclinic_channel_tasks</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.cosine_bell</span> <span class="kn">import</span> <span class="n">add_cosine_bell_tasks</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.inertial_gravity_wave</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">add_inertial_gravity_wave_tasks</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.manufactured_solution</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">add_manufactured_solution_tasks</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.single_column</span> <span class="kn">import</span> <span class="n">add_single_column_tasks</span>


<span class="k">class</span> <span class="nc">Ocean</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The collection of all test case for the MPAS-Ocean core</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the collection of MPAS-Ocean test cases</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ocean&#39;</span><span class="p">)</span>

        <span class="c1"># please keep these in alphabetical order</span>
        <span class="n">add_baroclinic_channel_tasks</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">add_cosine_bell_tasks</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">add_inertial_gravity_wave_tasks</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">add_manufactured_solution_tasks</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">add_single_column_tasks</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>The object <code class="docutils literal notranslate"><span class="pre">self</span></code> is always passed as the <code class="docutils literal notranslate"><span class="pre">component</span></code> argument to the helper
function so it can, in turn, be used both to add the task to the component and
to identify which component the task belongs to in its constructor.</p>
<p>An example of a helper function that adds tasks for baroclinic channel test
cases is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">polaris.ocean.resolution</span> <span class="kn">import</span> <span class="n">resolution_to_subdir</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.baroclinic_channel.decomp</span> <span class="kn">import</span> <span class="n">Decomp</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.baroclinic_channel.default</span> <span class="kn">import</span> <span class="n">Default</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.baroclinic_channel.init</span> <span class="kn">import</span> <span class="n">Init</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.baroclinic_channel.restart</span> <span class="kn">import</span> <span class="n">Restart</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.baroclinic_channel.rpe</span> <span class="kn">import</span> <span class="n">Rpe</span>
<span class="kn">from</span> <span class="nn">polaris.ocean.tasks.baroclinic_channel.threads</span> <span class="kn">import</span> <span class="n">Threads</span>


<span class="k">def</span> <span class="nf">add_baroclinic_channel_tasks</span><span class="p">(</span><span class="n">component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add tasks for different baroclinic channel tests to the ocean component</span>

<span class="sd">    component : polaris.ocean.Ocean</span>
<span class="sd">        the ocean component that the tasks will be added to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">resolution</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]:</span>
        <span class="n">resdir</span> <span class="o">=</span> <span class="n">resolution_to_subdir</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
        <span class="n">resdir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;planar/baroclinic_channel/</span><span class="si">{</span><span class="n">resdir</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">init</span> <span class="o">=</span> <span class="n">Init</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">indir</span><span class="o">=</span><span class="n">resdir</span><span class="p">)</span>

        <span class="n">component</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
            <span class="n">Default</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                    <span class="n">indir</span><span class="o">=</span><span class="n">resdir</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">resolution</span> <span class="o">==</span> <span class="mf">10.</span><span class="p">:</span>
            <span class="n">component</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
                <span class="n">Decomp</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                       <span class="n">indir</span><span class="o">=</span><span class="n">resdir</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">))</span>

            <span class="n">component</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
                <span class="n">Restart</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                        <span class="n">indir</span><span class="o">=</span><span class="n">resdir</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">))</span>

            <span class="n">component</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
                <span class="n">Threads</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                        <span class="n">indir</span><span class="o">=</span><span class="n">resdir</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">))</span>

        <span class="n">component</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span>
            <span class="n">Rpe</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">component</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                <span class="n">indir</span><span class="o">=</span><span class="n">resdir</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="config-file">
<h2>Config file<a class="headerlink" href="#config-file" title="Permalink to this heading"></a></h2>
<p>The config file for the component should, at the very least, define the
default value for the <code class="docutils literal notranslate"><span class="pre">component_path</span></code> path in the <code class="docutils literal notranslate"><span class="pre">[paths]</span></code> section.  This
path should point to the path within the appropriate E3SM submodule where the
standalone component can be built.  This is the path to the directory where the
E3SM component’s executable will be built, not to the executable itself.</p>
<p>Typically, the config file will also define the paths to the component
executable  and the default namelist and streams files for “forward mode” (and,
for  MPAS-Ocean, “init mode”):</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="c1"># This config file has default config options for the landice core</span>

<span class="c1"># The paths section points polaris to external paths</span>
<span class="k">[paths]</span>

<span class="c1"># the relative or absolute path to the root of a branch where MALI has been</span>
<span class="c1"># built</span>
<span class="na">component_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">e3sm_submodules/MALI-Dev/components/mpas-albany-landice</span>

<span class="c1"># The namelists section defines paths to example_compact namelists that will be used</span>
<span class="c1"># to generate specific namelists. By default, these point to the forward and</span>
<span class="c1"># init namelists in the default_inputs directory after a successful build of</span>
<span class="c1"># the landice model.  Change these in a custom config file if you need a different</span>
<span class="c1"># example_compact.</span>
<span class="k">[namelists]</span>
<span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${paths:component_path}/default_inputs/namelist.landice</span>

<span class="c1"># The streams section defines paths to example_compact streams files that will be used</span>
<span class="c1"># to generate specific streams files. By default, these point to the forward and</span>
<span class="c1"># init streams files in the default_inputs directory after a successful build of</span>
<span class="c1"># the landice model. Change these in a custom config file if you need a different</span>
<span class="c1"># example_compact.</span>
<span class="k">[streams]</span>
<span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${paths:component_path}/default_inputs/streams.landice</span>


<span class="c1"># The executables section defines paths to required executables. These</span>
<span class="c1"># executables are provided for use by specific tasks.  Most tools that</span>
<span class="c1"># polaris needs should be in the conda environment, so this is only the path</span>
<span class="c1"># to the MALI executable by default.</span>
<span class="k">[executables]</span>
<span class="na">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${paths:component_path}/landice_model</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="directories.html" class="btn btn-neutral float-left" title="Directory structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="categories_of_tasks.html" class="btn btn-neutral float-right" title="Categories of tasks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Energy Exascale Earth System Model Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="components.html">main</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>